任何JavaScript代码在执行之前都要进行编译。也就是JavaScript代码的整个执行过程，分为两个阶段，代码编译阶段与代码执行阶段。而作用域和作用域链就是分别是编译和执行阶段确认的。

* 编译阶段
  - 分词/词法分析
  - 解析/语法分析
  - 生成可执行代码
* 执行阶段
  - 执行上下文创建
  - 代码执行

在《你不知道的javascript-上》里有这样举例：
```
var a = 2;
```
这段代码的执行过程就是：
1. 分解成词法单元
2. 解析成树结构
3. 可执行代码生成  

而在第三步过程中编译器需要进行如下处理：  
1. 遇到var a, 编译器会询问作用域是否已经有一个该名称的变量在于同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译。否则会要求作用域在当前作用域集合中声明一个新的变量，并命名为a。
2. 生成运行时所需代码。用来处理a=2这个赋值操作。运行时会询问作用域，在当前作用域集合中是否存在一个叫作a的变量。如果是，引擎就会使用这个变量。不是，引擎就会继续查找该变量。（向父级作用域一层层查找，这就是作用域链的概念）

## 作用域 & 作用域链
上边已经引出了作用域及作用域链的概念。
* 作用域
  - 负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，来确定当前执行的代码对这些标识符的访问权限。简单来说就是用来确定变量的访问权限的一套规则
  - es6以后作用域有：全局作用域、函数作用域和块级作用域
  - 作用域规则是编译阶段已经确认的
* 作用域链
  - 执行上下文创建过程中会确认作用域链
  - 是由当前环境与上层环境的一系列变量对象组成，它保证了当前执行环境对符合访问权限的变量和函数的有序访问

## 疑问
JavaScript采用词法作用域(lexical scoping)，也就是说：JavaScript的变量和函数作用域是在定义时决定的，而不是执行时决定的，由于词法作用域取决于源代码结构，所以 JavaScript解释器只需要通过静态分析就能确定每个变量、函数的作用域，这种作用域也称为静态作用域（static scope）。

## 举例
```
function F1() {
　　var a = 100
　　return function () {
　　　　console.log(a)
　　}
}
function F2(f1) {
　　var a = 200
　　console.log(f1())
}
var f1 = F1()
F2(f1) // 100
```